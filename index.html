<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4f46e5">
    <meta name="description" content="Track your JEE coaching test progress">
    <title>JEE Test Progress Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Support -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideUp 0.5s ease-out;
            display: none;
        }
        
        .install-prompt.show {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .install-btn {
            background: white;
            color: #667eea;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }
        
        .install-btn:hover {
            transform: scale(1.05);
        }
        
        .dismiss-btn {
            background: transparent;
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <span>ðŸ“± Install JEE Tracker as an app!</span>
        <button id="installBtn" class="install-btn">Install</button>
        <button id="dismissBtn" class="dismiss-btn">Later</button>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar } = Recharts;

        // Icons
        const TrendingUp = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const TrendingDown = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                <polyline points="17 18 23 18 23 12"></polyline>
            </svg>
        );

        const Target = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
        );

        const Award = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
        );

        const Calendar = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Plus = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Download = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        function JEETestTracker() {
            const [tests, setTests] = useState([]);
            const [formData, setFormData] = useState({
                date: '',
                physics: '',
                chemistry: '',
                maths: '',
                totalMarks: 300
            });

            useEffect(() => {
                const saved = localStorage.getItem('jee-tests');
                if (saved) {
                    setTests(JSON.parse(saved));
                }
            }, []);

            const saveTests = (newTests) => {
                localStorage.setItem('jee-tests', JSON.stringify(newTests));
            };

            const handleSubmit = () => {
                if (!formData.date || !formData.physics || !formData.chemistry || !formData.maths) {
                    alert('Please fill in all fields');
                    return;
                }

                const newTest = {
                    id: Date.now(),
                    date: formData.date,
                    physics: parseFloat(formData.physics),
                    chemistry: parseFloat(formData.chemistry),
                    maths: parseFloat(formData.maths),
                    total: parseFloat(formData.physics) + parseFloat(formData.chemistry) + parseFloat(formData.maths),
                    totalMarks: parseFloat(formData.totalMarks),
                    percentage: ((parseFloat(formData.physics) + parseFloat(formData.chemistry) + parseFloat(formData.maths)) / parseFloat(formData.totalMarks)) * 100
                };

                const updatedTests = [...tests, newTest].sort((a, b) => new Date(a.date) - new Date(b.date));
                setTests(updatedTests);
                saveTests(updatedTests);

                setFormData({
                    date: '',
                    physics: '',
                    chemistry: '',
                    maths: '',
                    totalMarks: 300
                });
            };

            const deleteTest = (id) => {
                const updatedTests = tests.filter(test => test.id !== id);
                setTests(updatedTests);
                saveTests(updatedTests);
            };

            const exportData = () => {
                const dataStr = JSON.stringify(tests, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `jee-tests-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };

            const importData = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const importedTests = JSON.parse(event.target.result);
                            setTests(importedTests);
                            saveTests(importedTests);
                            alert('Data imported successfully!');
                        } catch (error) {
                            alert('Error importing data. Please check the file.');
                        }
                    };
                    reader.readAsText(file);
                }
            };

            const calculateStats = () => {
                if (tests.length === 0) return null;

                const latestTest = tests[tests.length - 1];
                const previousTest = tests.length > 1 ? tests[tests.length - 2] : null;

                const avgPercentage = tests.reduce((sum, test) => sum + test.percentage, 0) / tests.length;
                const maxScore = Math.max(...tests.map(t => t.total));
                const minScore = Math.min(...tests.map(t => t.total));

                const progressChange = previousTest 
                    ? ((latestTest.total - previousTest.total) / previousTest.total) * 100 
                    : 0;

                const nextTestDate = new Date(latestTest.date);
                nextTestDate.setDate(nextTestDate.getDate() + 21);

                return {
                    latestTest,
                    previousTest,
                    avgPercentage,
                    maxScore,
                    minScore,
                    progressChange,
                    nextTestDate: nextTestDate.toLocaleDateString('en-GB')
                };
            };

            const stats = calculateStats();

            const chartData = tests.map(test => ({
                date: new Date(test.date).toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }),
                Physics: test.physics,
                Chemistry: test.chemistry,
                Maths: test.maths,
                Total: test.total,
                Percentage: test.percentage.toFixed(1)
            }));

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h1 className="text-4xl font-bold text-indigo-900 mb-2 flex items-center gap-3">
                                        <Target />
                                        JEE Test Progress Tracker
                                    </h1>
                                    <p className="text-gray-600">Track your performance every 21 days</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={exportData}
                                        className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors"
                                        title="Backup your data"
                                    >
                                        <Download />
                                        Export
                                    </button>
                                    <label className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg cursor-pointer transition-colors">
                                        <Upload />
                                        Import
                                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                                    </label>
                                </div>
                            </div>
                        </div>

                        {stats && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div className="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-5 text-white shadow-lg">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-green-100">Latest Score</span>
                                        <Award />
                                    </div>
                                    <div className="text-3xl font-bold">{stats.latestTest.total}/{stats.latestTest.totalMarks}</div>
                                    <div className="text-green-100 text-sm">{stats.latestTest.percentage.toFixed(2)}%</div>
                                </div>

                                <div className={`bg-gradient-to-br ${stats.progressChange >= 0 ? 'from-blue-500 to-blue-600' : 'from-red-500 to-red-600'} rounded-xl p-5 text-white shadow-lg`}>
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-white/90">Progress</span>
                                        {stats.progressChange >= 0 ? <TrendingUp /> : <TrendingDown />}
                                    </div>
                                    <div className="text-3xl font-bold">{stats.progressChange >= 0 ? '+' : ''}{stats.progressChange.toFixed(2)}%</div>
                                    <div className="text-white/90 text-sm">vs previous test</div>
                                </div>

                                <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-5 text-white shadow-lg">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-purple-100">Average</span>
                                        <Target />
                                    </div>
                                    <div className="text-3xl font-bold">{stats.avgPercentage.toFixed(2)}%</div>
                                    <div className="text-purple-100 text-sm">Overall performance</div>
                                </div>

                                <div className="bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl p-5 text-white shadow-lg">
                                    <div className="flex items-center justify-between mb-2">
                                        <span className="text-orange-100">Next Test</span>
                                        <Calendar />
                                    </div>
                                    <div className="text-2xl font-bold">{stats.nextTestDate}</div>
                                    <div className="text-orange-100 text-sm">In 21 days cycle</div>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <div className="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Performance Trend</h2>
                                {tests.length > 0 ? (
                                    <ResponsiveContainer width="100%" height={300}>
                                        <LineChart data={chartData}>
                                            <CartesianGrid strokeDasharray="3 3" />
                                            <XAxis dataKey="date" />
                                            <YAxis />
                                            <Tooltip />
                                            <Legend />
                                            <Line type="monotone" dataKey="Total" stroke="#8b5cf6" strokeWidth={3} />
                                            <Line type="monotone" dataKey="Physics" stroke="#3b82f6" strokeWidth={2} />
                                            <Line type="monotone" dataKey="Chemistry" stroke="#10b981" strokeWidth={2} />
                                            <Line type="monotone" dataKey="Maths" stroke="#f59e0b" strokeWidth={2} />
                                        </LineChart>
                                    </ResponsiveContainer>
                                ) : (
                                    <div className="h-[300px] flex items-center justify-center text-gray-400">
                                        Add test scores to see your progress graph
                                    </div>
                                )}
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                                    <Plus />
                                    Add Test Score
                                </h2>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Test Date</label>
                                        <input
                                            type="date"
                                            value={formData.date}
                                            onChange={(e) => setFormData({...formData, date: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Physics Marks</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.physics}
                                            onChange={(e) => setFormData({...formData, physics: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Chemistry Marks</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.chemistry}
                                            onChange={(e) => setFormData({...formData, chemistry: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Maths Marks</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            value={formData.maths}
                                            onChange={(e) => setFormData({...formData, maths: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Total Marks</label>
                                        <input
                                            type="number"
                                            value={formData.totalMarks}
                                            onChange={(e) => setFormData({...formData, totalMarks: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        />
                                    </div>
                                    <button
                                        onClick={handleSubmit}
                                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 rounded-lg transition-colors shadow-lg"
                                    >
                                        Add Test Result
                                    </button>
                                </div>
                            </div>
                        </div>

                        {tests.length > 0 && (
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Subject-wise Analysis</h2>
                                <ResponsiveContainer width="100%" height={300}>
                                    <BarChart data={chartData}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="date" />
                                        <YAxis />
                                        <Tooltip />
                                        <Legend />
                                        <Bar dataKey="Physics" fill="#3b82f6" />
                                        <Bar dataKey="Chemistry" fill="#10b981" />
                                        <Bar dataKey="Maths" fill="#f59e0b" />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        )}

                        {tests.length > 0 && (
                            <div className="bg-white rounded-xl shadow-lg p-6 mt-6">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Test History</h2>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead>
                                            <tr className="border-b-2 border-gray-200">
                                                <th className="text-left py-3 px-4">Date</th>
                                                <th className="text-left py-3 px-4">Physics</th>
                                                <th className="text-left py-3 px-4">Chemistry</th>
                                                <th className="text-left py-3 px-4">Maths</th>
                                                <th className="text-left py-3 px-4">Total</th>
                                                <th className="text-left py-3 px-4">Percentage</th>
                                                <th className="text-left py-3 px-4">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {tests.map((test) => (
                                                <tr key={test.id} className="border-b border-gray-100 hover:bg-gray-50">
                                                    <td className="py-3 px-4">{new Date(test.date).toLocaleDateString('en-GB')}</td>
                                                    <td className="py-3 px-4 text-blue-600 font-semibold">{test.physics}</td>
                                                    <td className="py-3 px-4 text-green-600 font-semibold">{test.chemistry}</td>
                                                    <td className="py-3 px-4 text-orange-600 font-semibold">{test.maths}</td>
                                                    <td className="py-3 px-4 font-bold">{test.total}/{test.totalMarks}</td>
                                                    <td className="py-3 px-4">
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                            test.percentage >= 75 ? 'bg-green-100 text-green-800' :
                                                            test.percentage >= 50 ? 'bg-yellow-100 text-yellow-800' :
                                                            'bg-red-100 text-red-800'
                                                        }`}>
                                                            {test.percentage.toFixed(2)}%
                                                        </span>
                                                    </td>
                                                    <td className="py-3 px-4">
                                                        <button
                                                            onClick={() => deleteTest(test.id)}
                                                            className="text-red-600 hover:text-red-800 transition-colors"
                                                        >
                                                            <Trash2 />
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<JEETestTracker />, document.getElementById('root'));
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }

        // Install prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.classList.add('show');
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                installPrompt.classList.remove('show');
            }
        });

        dismissBtn.addEventListener('click', () => {
            installPrompt.classList.remove('show');
        });
    </script>
</body>
</html>